(()=>{var e={};e.id=668,e.ids=[668],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9080:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>d,routeModule:()=>u,tree:()=>c}),r(3777),r(3127),r(5866);var t=r(3191),a=r(8716),n=r(7922),i=r.n(n),l=r(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(s,o);let c=["",{children:["admin",{children:["analytics",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,3777)),"/Users/mayingkun/mkwork/cursorproject/H5/Dramini/app/admin/analytics/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,3127)),"/Users/mayingkun/mkwork/cursorproject/H5/Dramini/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mayingkun/mkwork/cursorproject/H5/Dramini/app/admin/analytics/page.tsx"],x="/admin/analytics/page",m={require:r,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/analytics/page",pathname:"/admin/analytics",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},7749:(e,s,r)=>{Promise.resolve().then(r.bind(r,2723))},79:(e,s,r)=>{Promise.resolve().then(r.bind(r,356)),Promise.resolve().then(r.bind(r,6661)),Promise.resolve().then(r.bind(r,6365))},4885:(e,s,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},2723:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>h});var t=r(326),a=r(7577),n=r(3071),i=r(6557);let l=(0,i.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var o=r(2714);let c=(0,i.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),d=(0,i.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),x=(0,i.Z)("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);var m=r(7069),u=r(4659),p=r(772);function h(){let[e,s]=(0,a.useState)("today"),[r,i]=(0,a.useState)("day"),[h,y]=(0,a.useState)([]),[f,b]=(0,a.useState)(null),[j,g]=(0,a.useState)(!0),[v,N]=(0,a.useState)(null),w=async()=>{try{g(!0);let s=new URLSearchParams({granularity:r,days:"today"===e?"1":"week"===e?"7":"30"}),t=await fetch(`/api/analytics/stats?${s}`),a=await t.json();a.success?y(a.data.stats||[]):N(a.error||"Failed to fetch analytics data")}catch(e){N("Network error occurred"),console.error("Analytics fetch error:",e)}finally{g(!1)}},k=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString();return v?t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsx(n.Zb,{children:t.jsx(n.aY,{className:"flex items-center justify-center py-12",children:(0,t.jsxs)("div",{className:"text-center",children:[t.jsx(l,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-semibold mb-2",children:"数据加载失败"}),t.jsx("p",{className:"text-gray-600 mb-4",children:v}),t.jsx(p.z,{onClick:()=>{N(null),w()},children:"重新加载"})]})})})}):(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[t.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Analytics Dashboard"}),t.jsx("p",{className:"text-gray-600",children:"网站访问统计与分析"})]}),(0,t.jsxs)("div",{className:"mb-6 flex flex-wrap gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"时间范围:"}),(0,t.jsxs)("select",{value:e,onChange:e=>s(e.target.value),className:"border rounded px-3 py-1",children:[t.jsx("option",{value:"today",children:"今天"}),t.jsx("option",{value:"week",children:"最近7天"}),t.jsx("option",{value:"month",children:"最近30天"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("label",{className:"text-sm font-medium",children:"统计粒度:"}),(0,t.jsxs)("select",{value:r,onChange:e=>i(e.target.value),className:"border rounded px-3 py-1",children:[t.jsx("option",{value:"hour",children:"小时"}),t.jsx("option",{value:"day",children:"天"}),t.jsx("option",{value:"month",children:"月"}),t.jsx("option",{value:"year",children:"年"})]})]})]}),f&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)(n.Zb,{children:[(0,t.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n.ll,{className:"text-sm font-medium",children:"页面浏览量"}),t.jsx(o.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.aY,{children:[t.jsx("div",{className:"text-2xl font-bold",children:k(f.today.pv)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[f.today.pv," 今天"]})]})]}),(0,t.jsxs)(n.Zb,{children:[(0,t.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n.ll,{className:"text-sm font-medium",children:"独立访客"}),t.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.aY,{children:[t.jsx("div",{className:"text-2xl font-bold",children:k(f.today.uv)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[f.today.uv," 今天"]})]})]}),(0,t.jsxs)(n.Zb,{children:[(0,t.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n.ll,{className:"text-sm font-medium",children:"注册用户"}),t.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.aY,{children:[t.jsx("div",{className:"text-2xl font-bold",children:k(f.today.registrations)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[f.today.registrations," 今天"]})]})]}),(0,t.jsxs)(n.Zb,{children:[(0,t.jsxs)(n.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(n.ll,{className:"text-sm font-medium",children:"观看用户"}),t.jsx(x,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(n.aY,{children:[t.jsx("div",{className:"text-2xl font-bold",children:k(f.today.viewers)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[f.today.viewers," 今天"]})]})]})]}),(0,t.jsxs)(n.Zb,{children:[t.jsx(n.Ol,{children:(0,t.jsxs)(n.ll,{className:"flex items-center gap-2",children:[t.jsx(m.Z,{className:"h-5 w-5"}),"详细数据 - ",(e=>{switch(e){case"today":return"今天";case"week":return"最近7天";case"month":return"最近30天";default:return e}})(e)," (",(e=>{switch(e){case"hour":return"小时";case"day":return"天";case"month":return"月";case"year":return"年";default:return e}})(r),"级统计)"]})}),t.jsx(n.aY,{children:j?(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),t.jsx("span",{className:"ml-2",children:"加载中..."})]}):0===h.length?t.jsx("div",{className:"text-center py-8 text-gray-500",children:"暂无数据"}):t.jsx("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full border-collapse",children:[t.jsx("thead",{children:(0,t.jsxs)("tr",{className:"border-b",children:[t.jsx("th",{className:"text-left py-3 px-4",children:"日期"}),t.jsx("th",{className:"text-left py-3 px-4",children:"页面浏览量 (PV)"}),t.jsx("th",{className:"text-left py-3 px-4",children:"独立访客 (UV)"}),t.jsx("th",{className:"text-left py-3 px-4",children:"注册用户"}),t.jsx("th",{className:"text-left py-3 px-4",children:"观看用户"})]})}),t.jsx("tbody",{children:h.map((e,s)=>(0,t.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[t.jsx("td",{className:"py-3 px-4",children:e.date}),t.jsx("td",{className:"py-3 px-4 font-mono",children:e.pv.toLocaleString()}),t.jsx("td",{className:"py-3 px-4 font-mono",children:e.uv.toLocaleString()}),t.jsx("td",{className:"py-3 px-4 font-mono",children:e.registrations.toLocaleString()}),t.jsx("td",{className:"py-3 px-4 font-mono",children:e.viewers.toLocaleString()})]},s))})]})})})]}),(0,t.jsxs)(n.Zb,{className:"mt-6",children:[t.jsx(n.Ol,{children:(0,t.jsxs)(n.ll,{className:"flex items-center gap-2",children:[t.jsx(u.Z,{className:"h-5 w-5 text-green-500"}),"第三方Analytics对比"]})}),(0,t.jsxs)(n.aY,{children:[t.jsx("p",{className:"text-gray-600 mb-4",children:"我们的Analytics系统已经与主流的第三方统计工具对齐，包括Google Analytics 4和Plausible。 数据偏差应该在\xb15-10%的合理范围内。"}),(0,t.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[t.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"验证方法"}),t.jsx("p",{className:"text-blue-800 text-sm",children:"请使用以下命令验证Analytics数据的准确性："}),t.jsx("code",{className:"block mt-2 p-2 bg-blue-100 rounded text-sm",children:"curl https://dramini-api.onrender.com/analytics/overview | jq"})]})]})]})]})}},356:(e,s,r)=>{"use strict";function t(){return null}r.d(s,{AnalyticsInit:()=>t}),r(7577),r(4348)},6661:(e,s,r)=>{"use strict";r.d(s,{AnalyticsProvider:()=>a});var t=r(326);function a({children:e}){return t.jsx(t.Fragment,{children:e})}r(7577),r(4348)},6365:(e,s,r)=>{"use strict";r.d(s,{ToastProvider:()=>n});var t=r(326),a=r(381);function n(){return t.jsx(a.x7,{position:"top-center",toastOptions:{duration:4e3,style:{background:"#1f2937",color:"#f9fafb",border:"1px solid #374151",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontWeight:"500",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},success:{iconTheme:{primary:"#10b981",secondary:"#f9fafb"},style:{background:"#1f2937",color:"#f9fafb",border:"1px solid #10b981"}},error:{iconTheme:{primary:"#ef4444",secondary:"#f9fafb"},style:{background:"#1f2937",color:"#f9fafb",border:"1px solid #ef4444"}},loading:{iconTheme:{primary:"#3b82f6",secondary:"#f9fafb"},style:{background:"#1f2937",color:"#f9fafb",border:"1px solid #3b82f6"}}}})}},772:(e,s,r)=>{"use strict";r.d(s,{z:()=>c});var t=r(326),a=r(7577),n=r(6438),i=r(9360),l=r(7863);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef(({className:e,variant:s,size:r,asChild:a=!1,...i},c)=>{let d=a?n.g7:"button";return t.jsx(d,{className:(0,l.cn)(o({variant:s,size:r,className:e})),ref:c,...i})});c.displayName="Button"},3071:(e,s,r)=>{"use strict";r.d(s,{Ol:()=>l,Zb:()=>i,aY:()=>c,ll:()=>o});var t=r(326),a=r(7577),n=r(7863);let i=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));i.displayName="Card";let l=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...s}));l.displayName="CardHeader";let o=a.forwardRef(({className:e,...s},r)=>t.jsx("h3",{ref:r,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",e),...s}));o.displayName="CardTitle",a.forwardRef(({className:e,...s},r)=>t.jsx("p",{ref:r,className:(0,n.cn)("text-sm text-muted-foreground",e),...s})).displayName="CardDescription";let c=a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...s}));c.displayName="CardContent",a.forwardRef(({className:e,...s},r)=>t.jsx("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter"},4348:()=>{throw Error("Module build failed (from ./node_modules/next/dist/build/webpack/loaders/next-swc-loader.js):\nError: \n  \x1b[31mx\x1b[0m Expected ',', got '}'\n    ,-[\x1b[36;1;4m/Users/mayingkun/mkwork/cursorproject/H5/Dramini/lib/analytics.ts\x1b[0m:57:1]\n \x1b[2m57\x1b[0m |           },\n \x1b[2m58\x1b[0m |           created_at: new Date().toISOString()\n \x1b[2m59\x1b[0m |     }\n \x1b[2m60\x1b[0m |         })\n    : \x1b[31;1m        ^\x1b[0m\n \x1b[2m61\x1b[0m |         \n \x1b[2m62\x1b[0m |         console.log('Initial page_view event sent')\n \x1b[2m63\x1b[0m |       }\n    `----\n\n\nCaused by:\n    Syntax Error")},7863:(e,s,r)=>{"use strict";r.d(s,{T4:()=>i,cn:()=>n});var t=r(1135),a=r(1009);function n(...e){return(0,a.m6)((0,t.W)(e))}function i(e){return`$${(e/100).toFixed(2)}`}},4659:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(6557).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2714:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(6557).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},7069:(e,s,r)=>{"use strict";r.d(s,{Z:()=>t});let t=(0,r(6557).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},3777:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(8570).createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/Dramini/app/admin/analytics/page.tsx#default`)},3127:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>c,metadata:()=>o});var t=r(9510);r(7272);var a=r(8570);let n=(0,a.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/Dramini/components/toast-provider.tsx#ToastProvider`),i=(0,a.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/Dramini/components/AnalyticsProvider.tsx#AnalyticsProvider`);(0,a.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/Dramini/components/AnalyticsProvider.tsx#useAnalyticsInit`);let l=(0,a.createProxy)(String.raw`/Users/mayingkun/mkwork/cursorproject/H5/Dramini/components/AnalyticsInit.tsx#AnalyticsInit`),o={title:"Dramini",description:"Your streaming platform"};function c({children:e}){return t.jsx("html",{lang:"en",children:t.jsx("body",{className:"font-sans",children:(0,t.jsxs)(i,{children:[t.jsx(l,{}),e,t.jsx(n,{})]})})})}},7272:()=>{}};var s=require("../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[276,186,427],()=>r(9080));module.exports=t})();