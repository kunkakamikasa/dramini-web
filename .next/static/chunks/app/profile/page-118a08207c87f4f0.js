(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{6039:function(e,s,t){Promise.resolve().then(t.bind(t,8952))},8952:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return N}});var r=t(7437),a=t(2265),n=t(9376),i=t(7648),l=t(2869),c=t(6070),o=t(5974),d=t(6512),m=t(9232),x=t(7692),u=t(2369),h=t(9763);let f=(0,h.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var g=t(3276),p=t(1723),y=t(525),v=t(2489);let b=(0,h.Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);var j=t(8226);function N(){var e;let s=(0,n.useRouter)(),[t,h]=(0,a.useState)(null),[N,w]=(0,a.useState)(!0),[k,Z]=(0,a.useState)(!1),[C,S]=(0,a.useState)([]),[P,U]=(0,a.useState)(null),[I,z]=(0,a.useState)("paypal");(0,a.useEffect)(()=>{if(!localStorage.getItem("userId")){s.push("/login?redirect=/profile");return}R()},[s]);let R=async()=>{try{let e=localStorage.getItem("userId"),s=await fetch("/api/user/profile?userId=".concat(e));if(s.ok){let e=await s.json();h(e)}else h({id:e||"",name:localStorage.getItem("userName")||"User",email:localStorage.getItem("userEmail")||"",coins:0,watchHistory:[]})}catch(e){console.error("Failed to fetch user data:",e),h({id:localStorage.getItem("userId")||"",name:localStorage.getItem("userName")||"User",email:localStorage.getItem("userEmail")||"",coins:0,watchHistory:[]})}finally{w(!1)}},M=async()=>{try{let e=await fetch("".concat("https://dramini-api.onrender.com/api/v1","/payment-packages")),s=await e.json();if(s.ok&&s.packages){let e=s.packages.map(e=>({id:e.id,name:e.name,coins:e.coins,bonus:e.bonus||0,price:e.price,discount:e.discount,isNewUser:e.isNewUser||!1,description:e.description}));S(e)}else S([{id:"default1",name:"入门档",coins:500,bonus:50,price:4.99,discount:"+10%",isNewUser:!1,description:"新手推荐"}])}catch(e){console.error("Failed to fetch payment packages:",e),S([{id:"default1",name:"入门档",coins:500,bonus:50,price:4.99,discount:"+10%",isNewUser:!1,description:"新手推荐"}])}},E=async()=>{if(!P){alert("Please select a package first");return}let e=localStorage.getItem("userId");if(!e){alert("Please login first");return}try{let s=await fetch("".concat("https://dramini-api.onrender.com/api/v1","/api/v1/user/purchase/checkout/").concat(I),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tierKey:P.id,userId:e})});if(s.ok){let e=await s.json();e.checkoutUrl?window.location.href=e.checkoutUrl:alert("Payment initiated successfully!")}else alert("Payment failed. Please try again.")}catch(e){console.error("Payment error:",e),alert("Payment failed. Please try again.")}},H=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),O=e=>{let s=Math.floor(e/3600),t=Math.floor(e%3600/60);return s>0?"".concat(s,"h ").concat(t,"m"):"".concat(t,"m")};return N?(0,r.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("div",{className:"text-lg mb-4",children:"Loading..."})})}):t?(0,r.jsxs)("div",{className:"min-h-screen bg-black text-white",children:[(0,r.jsx)("div",{className:"bg-gray-900 border-b border-gray-800",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,r.jsx)("div",{className:"flex items-center gap-4",children:(0,r.jsx)(i.default,{href:"/",className:"text-xl font-bold text-red-500",children:"Dramini"})}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400",children:[(0,r.jsx)(m.Z,{className:"w-5 h-5"}),(0,r.jsx)("span",{className:"font-semibold",children:t.coins})]}),(0,r.jsxs)(l.z,{variant:"ghost",onClick:()=>{localStorage.removeItem("userId"),localStorage.removeItem("userEmail"),localStorage.removeItem("userName"),s.push("/")},className:"text-gray-400 hover:text-white",children:[(0,r.jsx)(x.Z,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]})})}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 lg:py-8",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 lg:gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-1",children:(0,r.jsxs)(c.Zb,{className:"bg-gray-900 border-gray-700",children:[(0,r.jsx)(c.Ol,{children:(0,r.jsxs)(c.ll,{className:"text-white flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"w-5 h-5"}),"Profile"]})}),(0,r.jsxs)(c.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg",children:(0,r.jsx)("span",{className:"text-white text-xl font-bold",children:(null===(e=t.name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"U"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:t.name}),(0,r.jsx)("p",{className:"text-gray-400",children:t.email})]})]}),(0,r.jsx)(d.Z,{className:"bg-gray-700"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"Coins Balance"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400",children:[(0,r.jsx)(m.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"font-semibold",children:t.coins})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-gray-300",children:"Episodes Watched"}),(0,r.jsx)("span",{className:"text-white font-semibold",children:t.watchHistory.length})]})]}),(0,r.jsx)("div",{className:"pt-4",children:(0,r.jsxs)(l.z,{className:"w-full bg-yellow-600 hover:bg-yellow-700 text-black",onClick:()=>{M(),Z(!0)},children:[(0,r.jsx)(m.Z,{className:"w-4 h-4 mr-2"}),"Top Up Coins"]})})]})]})}),(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsxs)(c.Zb,{className:"bg-gray-900 border-gray-700",children:[(0,r.jsx)(c.Ol,{children:(0,r.jsxs)(c.ll,{className:"text-white flex items-center gap-2",children:[(0,r.jsx)(f,{className:"w-5 h-5"}),"Watch History"]})}),(0,r.jsx)(c.aY,{children:0===t.watchHistory.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)(f,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-400 mb-2",children:"No watch history yet"}),(0,r.jsx)("p",{className:"text-gray-500 mb-6",children:"Start watching episodes to see your history here"}),(0,r.jsx)(i.default,{href:"/",children:(0,r.jsxs)(l.z,{className:"bg-red-600 hover:bg-red-700",children:[(0,r.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"Start Watching"]})})]}):(0,r.jsx)("div",{className:"space-y-4",children:t.watchHistory.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-800 rounded-lg hover:bg-gray-750 transition-colors",children:[(0,r.jsx)("div",{className:"w-20 h-12 bg-gray-700 rounded flex items-center justify-center",children:(0,r.jsx)(g.Z,{className:"w-6 h-6 text-gray-400"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h4",{className:"text-white font-semibold truncate",children:e.title}),(0,r.jsx)("p",{className:"text-gray-400 text-sm",children:e.episode}),(0,r.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.Z,{className:"w-3 h-3"}),O(e.duration)]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(y.Z,{className:"w-3 h-3"}),H(e.watchedAt)]})]})]}),(0,r.jsx)(l.z,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-white",children:(0,r.jsx)(g.Z,{className:"w-4 h-4"})})]},e.id))})})]})})]})}),k&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,r.jsx)("div",{className:"bg-gray-900 rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-white",children:"Top Up Coins"}),(0,r.jsx)(l.z,{variant:"ghost",size:"sm",onClick:()=>Z(!1),className:"text-gray-400 hover:text-white",children:(0,r.jsx)(v.Z,{className:"w-4 h-4"})})]}),(0,r.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:"充值金币"})}),(0,r.jsxs)("div",{className:"space-y-3",children:[C.filter(e=>e.isNewUser).map(e=>(0,r.jsxs)("div",{className:"bg-gradient-to-r from-red-500 to-pink-500 rounded-lg p-4 relative overflow-hidden cursor-pointer border-2 ".concat((null==P?void 0:P.id)===e.id?"border-yellow-400 ring-2 ring-yellow-400/50":"border-transparent"," transition-all hover:scale-[1.02]"),onClick:()=>U(e),children:[(0,r.jsx)("div",{className:"absolute top-2 right-2",children:(0,r.jsxs)(o.C,{className:"bg-yellow-500 text-black font-bold",children:[(0,r.jsx)(b,{className:"w-3 h-3 mr-1"}),e.discount]})}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"w-8 h-8 text-yellow-400"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-sm opacity-90",children:"NEW USER ONLY"}),(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[e.coins,(0,r.jsx)("span",{className:"text-lg",children:"Coins"})]}),(0,r.jsxs)("div",{className:"text-sm",children:["+",e.bonus," Bonus"]})]})]}),(0,r.jsxs)("div",{className:"ml-auto text-right",children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:["$",e.price]}),(0,r.jsx)("div",{className:"text-sm opacity-75",children:e.description})]})]})]},e.id)),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-3",children:C.filter(e=>!e.isNewUser).map(e=>(0,r.jsxs)("div",{className:"bg-gray-700 rounded-lg p-3 text-center relative cursor-pointer border-2 ".concat((null==P?void 0:P.id)===e.id?"border-yellow-400 ring-2 ring-yellow-400/50":"border-transparent"," transition-all hover:scale-105"),onClick:()=>U(e),children:[e.discount&&(0,r.jsx)(o.C,{className:"absolute -top-2 left-1/2 transform -translate-x-1/2 bg-orange-500 text-white text-xs",children:e.discount}),(0,r.jsxs)("div",{className:e.discount?"mt-2":"",children:[(0,r.jsx)("div",{className:"text-lg font-bold",children:e.coins}),e.bonus>0?(0,r.jsxs)("div",{className:"text-xs",children:["+",e.bonus," Bonus"]}):(0,r.jsx)("div",{className:"text-xs text-gray-400",children:"Coins"}),(0,r.jsxs)("div",{className:"text-sm font-semibold mt-2",children:["$",e.price]}),(0,r.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:e.description})]})]},e.id))})]})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("h3",{className:"text-white font-semibold mb-3",children:"Payment Method"}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("div",{className:"flex-1 border-2 rounded-lg p-3 cursor-pointer transition-all ".concat("paypal"===I?"border-red-500 bg-red-500/10":"border-gray-600 bg-gray-800"),onClick:()=>z("paypal"),children:(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"bg-blue-600 rounded px-3 py-2 text-white text-sm font-bold",children:"PayPal"})})}),(0,r.jsx)("div",{className:"flex-1 border-2 rounded-lg p-3 cursor-pointer transition-all ".concat("card"===I?"border-red-500 bg-red-500/10":"border-gray-600 bg-gray-800"),onClick:()=>z("card"),children:(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[(0,r.jsx)(j.Z,{className:"w-6 h-6 text-gray-400 mr-2"}),(0,r.jsx)("span",{className:"text-gray-400 text-sm",children:"Credit Card"})]})})]})]}),P&&(0,r.jsx)("div",{className:"bg-blue-900/30 border border-blue-500 rounded-lg p-3 mb-4",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-blue-300 text-sm",children:"已选择充值套餐："}),(0,r.jsxs)("div",{className:"text-white font-bold",children:[P.coins," 金币",P.bonus>0&&" + ".concat(P.bonus," 奖励"),"- $",P.price]})]})}),(0,r.jsxs)(l.z,{className:"w-full bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-bold py-4 text-lg rounded-lg transition-all",onClick:E,disabled:!P,children:[(0,r.jsx)(b,{className:"w-4 h-4 mr-2"}),"充值金币"]})]})})})]}):(0,r.jsx)("div",{className:"min-h-screen bg-black text-white flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-lg mb-4",children:"User not found"}),(0,r.jsx)(i.default,{href:"/login",children:(0,r.jsx)(l.z,{className:"bg-red-600 hover:bg-red-700",children:"Go to Login"})})]})})}},5974:function(e,s,t){"use strict";t.d(s,{C:function(){return l}});var r=t(7437);t(2265);var a=t(535),n=t(4508);let i=(0,a.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:t,...a}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:t}),s),...a})}},2869:function(e,s,t){"use strict";t.d(s,{z:function(){return o}});var r=t(7437),a=t(2265),n=t(5293),i=t(535),l=t(4508);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=a.forwardRef((e,s)=>{let{className:t,variant:a,size:i,asChild:o=!1,...d}=e,m=o?n.g7:"button";return(0,r.jsx)(m,{className:(0,l.cn)(c({variant:a,size:i,className:t})),ref:s,...d})});o.displayName="Button"},6070:function(e,s,t){"use strict";t.d(s,{Ol:function(){return l},Zb:function(){return i},aY:function(){return o},ll:function(){return c}});var r=t(7437),a=t(2265),n=t(4508);let i=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});i.displayName="Card";let l=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...a})});l.displayName="CardHeader";let c=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("h3",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});c.displayName="CardTitle",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...a})}).displayName="CardDescription";let o=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...a})});o.displayName="CardContent",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...a})}).displayName="CardFooter"},6512:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var r=t(7437),a=t(2265),n=t(4508);let i=a.forwardRef((e,s)=>{let{className:t,orientation:a="horizontal",decorative:i=!0,...l}=e;return(0,r.jsx)("div",{ref:s,role:i?"none":"separator","aria-orientation":a,className:(0,n.cn)("shrink-0 bg-gray-600","horizontal"===a?"h-[1px] w-full":"h-full w-[1px]",t),...l})});i.displayName="Separator"},4508:function(e,s,t){"use strict";t.d(s,{T4:function(){return i},cn:function(){return n}});var r=t(1994),a=t(3335);function n(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,a.m6)((0,r.W)(s))}function i(e){return"$".concat((e/100).toFixed(2))}},1723:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},9232:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]])},8226:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},7692:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},3276:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]])},525:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},2369:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2489:function(e,s,t){"use strict";t.d(s,{Z:function(){return r}});let r=(0,t(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,s,t){"use strict";t.d(s,{default:function(){return a.a}});var r=t(2972),a=t.n(r)},9376:function(e,s,t){"use strict";var r=t(5475);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"usePathname")&&t.d(s,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})}},function(e){e.O(0,[413,972,971,117,744],function(){return e(e.s=6039)}),_N_E=e.O()}]);