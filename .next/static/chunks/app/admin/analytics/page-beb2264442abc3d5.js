(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[668],{5749:function(e,t,s){Promise.resolve().then(s.bind(s,2088))},2088:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var r=s(7437),a=s(2265),l=s(6070),n=s(9763);let c=(0,n.Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var i=s(2208);let d=(0,n.Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),o=(0,n.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),x=(0,n.Z)("BarChart2",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);var u=s(525),m=s(5302),h=s(2869);function f(){let[e,t]=(0,a.useState)("today"),[s,n]=(0,a.useState)("day"),[f,y]=(0,a.useState)([]),[p,j]=(0,a.useState)(null),[v,N]=(0,a.useState)(!0),[b,g]=(0,a.useState)(null),w=async()=>{try{let e=await fetch("/api/analytics/overview"),t=await e.json();t.success&&j(t.data)}catch(e){console.error("Failed to fetch overview data:",e)}},k=async()=>{try{N(!0);let t=new URLSearchParams({granularity:s,days:"today"===e?"1":"week"===e?"7":"30"}),r=await fetch("/api/analytics/stats?".concat(t)),a=await r.json();a.success?y(a.data.stats||[]):g(a.error||"Failed to fetch analytics data")}catch(e){g("Network error occurred"),console.error("Analytics fetch error:",e)}finally{N(!1)}};(0,a.useEffect)(()=>{w()},[]),(0,a.useEffect)(()=>{k()},[e,s]);let Z=e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString();return b?(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsx)(l.Zb,{children:(0,r.jsx)(l.aY,{className:"flex items-center justify-center py-12",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(c,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"数据加载失败"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:b}),(0,r.jsx)(h.z,{onClick:()=>{g(null),k()},children:"重新加载"})]})})})}):(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Analytics Dashboard"}),(0,r.jsx)("p",{className:"text-gray-600",children:"网站访问统计与分析"})]}),(0,r.jsxs)("div",{className:"mb-6 flex flex-wrap gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"时间范围:"}),(0,r.jsxs)("select",{value:e,onChange:e=>t(e.target.value),className:"border rounded px-3 py-1",children:[(0,r.jsx)("option",{value:"today",children:"今天"}),(0,r.jsx)("option",{value:"week",children:"最近7天"}),(0,r.jsx)("option",{value:"month",children:"最近30天"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium",children:"统计粒度:"}),(0,r.jsxs)("select",{value:s,onChange:e=>n(e.target.value),className:"border rounded px-3 py-1",children:[(0,r.jsx)("option",{value:"hour",children:"小时"}),(0,r.jsx)("option",{value:"day",children:"天"}),(0,r.jsx)("option",{value:"month",children:"月"}),(0,r.jsx)("option",{value:"year",children:"年"})]})]})]}),p&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"页面浏览量"}),(0,r.jsx)(i.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:Z(p.today.pv)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[p.today.pv," 今天"]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"独立访客"}),(0,r.jsx)(d,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:Z(p.today.uv)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[p.today.uv," 今天"]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"注册用户"}),(0,r.jsx)(o,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:Z(p.today.registrations)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[p.today.registrations," 今天"]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsxs)(l.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(l.ll,{className:"text-sm font-medium",children:"观看用户"}),(0,r.jsx)(x,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:Z(p.today.viewers)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[p.today.viewers," 今天"]})]})]})]}),(0,r.jsxs)(l.Zb,{children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(u.Z,{className:"h-5 w-5"}),"详细数据 - ",(e=>{switch(e){case"today":return"今天";case"week":return"最近7天";case"month":return"最近30天";default:return e}})(e)," (",(e=>{switch(e){case"hour":return"小时";case"day":return"天";case"month":return"月";case"year":return"年";default:return e}})(s),"级统计)"]})}),(0,r.jsx)(l.aY,{children:v?(0,r.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),(0,r.jsx)("span",{className:"ml-2",children:"加载中..."})]}):0===f.length?(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:"暂无数据"}):(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full border-collapse",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"border-b",children:[(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"日期"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"页面浏览量 (PV)"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"独立访客 (UV)"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"注册用户"}),(0,r.jsx)("th",{className:"text-left py-3 px-4",children:"观看用户"})]})}),(0,r.jsx)("tbody",{children:f.map((e,t)=>(0,r.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,r.jsx)("td",{className:"py-3 px-4",children:e.date}),(0,r.jsx)("td",{className:"py-3 px-4 font-mono",children:e.pv.toLocaleString()}),(0,r.jsx)("td",{className:"py-3 px-4 font-mono",children:e.uv.toLocaleString()}),(0,r.jsx)("td",{className:"py-3 px-4 font-mono",children:e.registrations.toLocaleString()}),(0,r.jsx)("td",{className:"py-3 px-4 font-mono",children:e.viewers.toLocaleString()})]},t))})]})})})]}),(0,r.jsxs)(l.Zb,{className:"mt-6",children:[(0,r.jsx)(l.Ol,{children:(0,r.jsxs)(l.ll,{className:"flex items-center gap-2",children:[(0,r.jsx)(m.Z,{className:"h-5 w-5 text-green-500"}),"第三方Analytics对比"]})}),(0,r.jsxs)(l.aY,{children:[(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"我们的Analytics系统已经与主流的第三方统计工具对齐，包括Google Analytics 4和Plausible。 数据偏差应该在\xb15-10%的合理范围内。"}),(0,r.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,r.jsx)("h4",{className:"font-medium text-blue-900 mb-2",children:"验证方法"}),(0,r.jsx)("p",{className:"text-blue-800 text-sm",children:"请使用以下命令验证Analytics数据的准确性："}),(0,r.jsx)("code",{className:"block mt-2 p-2 bg-blue-100 rounded text-sm",children:"curl https://dramini-api.onrender.com/analytics/overview | jq"})]})]})]})]})}},2869:function(e,t,s){"use strict";s.d(t,{z:function(){return d}});var r=s(7437),a=s(2265),l=s(5293),n=s(535),c=s(4508);let i=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:s,variant:a,size:n,asChild:d=!1,...o}=e,x=d?l.g7:"button";return(0,r.jsx)(x,{className:(0,c.cn)(i({variant:a,size:n,className:s})),ref:t,...o})});d.displayName="Button"},6070:function(e,t,s){"use strict";s.d(t,{Ol:function(){return c},Zb:function(){return n},aY:function(){return d},ll:function(){return i}});var r=s(7437),a=s(2265),l=s(4508);let n=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a})});n.displayName="Card";let c=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex flex-col space-y-1.5 p-6",s),...a})});c.displayName="CardHeader";let i=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("h3",{ref:t,className:(0,l.cn)("text-2xl font-semibold leading-none tracking-tight",s),...a})});i.displayName="CardTitle",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("p",{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...a})}).displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("p-6 pt-0",s),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,l.cn)("flex items-center p-6 pt-0",s),...a})}).displayName="CardFooter"},4508:function(e,t,s){"use strict";s.d(t,{T4:function(){return n},cn:function(){return l}});var r=s(1994),a=s(3335);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,a.m6)((0,r.W)(t))}function n(e){return"$".concat((e/100).toFixed(2))}},5302:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2208:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},525:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});let r=(0,s(9763).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])}},function(e){e.O(0,[413,971,117,744],function(){return e(e.s=5749)}),_N_E=e.O()}]);