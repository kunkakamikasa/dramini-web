(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[882],{1894:function(e,t,r){Promise.resolve().then(r.bind(r,190))},190:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return x}});var n=r(7437),s=r(2265),i=r(2869),a=r(9763);let o=(0,a.Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),l=(0,a.Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var c=r(3145),u=r(5974),d=r(3276),f=r(6595),h=r(6337),g=r(3548),v=r(4508);function m(e){let{poster:t,index:r=0,section:i="unknown",onWatch:a,onUnlock:o}=e,[l,m]=(0,s.useState)(!1);return(0,n.jsxs)("div",{className:(0,v.cn)("group relative cursor-pointer transition-all duration-300 hover:scale-105","w-full max-w-[200px] mx-auto"),onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onClick:()=>{g.co.trackEvent("poster_click",{posterId:t.id,index:r,section:i}),null==a||a(t)},children:[(0,n.jsxs)("div",{className:"aspect-[9/16] rounded-xl overflow-hidden shadow-card",children:[(0,n.jsx)(c.default,{src:t.cover||t.poster,alt:t.title,fill:!0,className:"object-cover transition-transform duration-300 group-hover:scale-110"}),(0,n.jsx)("div",{className:(0,v.cn)("absolute inset-0 bg-black transition-opacity duration-300",l?"opacity-60":"opacity-0"),children:(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),g.co.trackEvent("poster_click",{posterId:t.id,index:r,section:i}),null==a||a(t)},className:"bg-white/20 backdrop-blur-sm rounded-full p-3 hover:bg-white/30 transition-colors",children:(0,n.jsx)(d.Z,{className:"h-6 w-6 text-white fill-white"})})})}),t.rating&&t.rating>4.5&&(0,n.jsx)("div",{className:"absolute top-2 right-2",children:(0,n.jsxs)(u.C,{variant:"secondary",className:"bg-yellow-500 text-black",children:[(0,n.jsx)(f.Z,{className:"h-3 w-3 mr-1"}),t.rating]})}),t.rating&&t.rating>4.5&&(0,n.jsx)("div",{className:"absolute top-2 left-2",children:(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),g.co.trackEvent("poster_click",{posterId:t.id,index:r,section:i}),null==o||o(t)},className:"bg-black/50 backdrop-blur-sm rounded-full p-2 hover:bg-black/70 transition-colors",children:(0,n.jsx)(h.Z,{className:"h-4 w-4 text-white"})})})]}),(0,n.jsxs)("div",{className:"mt-2 px-1",children:[(0,n.jsx)("h3",{className:"text-sm font-medium text-white truncate group-hover:text-gray-300 transition-colors",children:t.title}),t.year&&(0,n.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:t.year})]})]})}function p(e){let{items:t=[],title:r,showNavigation:a=!0,itemsPerView:c=3}=e,[u,d]=(0,s.useState)(0),[f,h]=(0,s.useState)(!1),[p,y]=(0,s.useState)(0),[x,b]=(0,s.useState)(0),k=(0,s.useRef)(null),j=Array.isArray(t)?t:[],w=Math.max(0,j.length-c),_=()=>{d(e=>e>=w?0:e+1)},N=()=>{d(e=>e<=0?w:e-1)},I=e=>{d(Math.max(0,Math.min(e,w)))};return((0,s.useEffect)(()=>{let e=e=>{e.target===k.current&&("ArrowLeft"===e.key?(e.preventDefault(),N()):"ArrowRight"===e.key&&(e.preventDefault(),_()))},t=k.current;return t&&(t.addEventListener("keydown",e),t.setAttribute("tabindex","0"),t.setAttribute("role","region"),t.setAttribute("aria-label",r||"Carousel")),()=>{t&&t.removeEventListener("keydown",e)}},[r]),(0,s.useEffect)(()=>{j.length>0&&j.slice(u,u+c).forEach((e,t)=>{g.co.trackEvent("poster_impression",{posterId:e.id,position:u+t,section:r||"carousel"})})},[u,j,c,r]),0===j.length)?(0,n.jsxs)("div",{className:"space-y-4",children:[r&&(0,n.jsx)("div",{className:"flex items-center justify-between",children:(0,n.jsx)("h2",{className:"text-3xl font-bold",children:r})}),(0,n.jsx)("div",{className:"text-center py-8 text-gray-400",children:"No content available"})]}):(0,n.jsxs)("div",{className:"space-y-4",children:[r&&(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h2",{className:"text-3xl font-bold",children:r}),a&&(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(i.z,{variant:"outline",size:"icon",onClick:N,className:"border-2","aria-label":"Previous slide",children:(0,n.jsx)(o,{className:"h-4 w-4"})}),(0,n.jsx)(i.z,{variant:"outline",size:"icon",onClick:_,className:"border-2","aria-label":"Next slide",children:(0,n.jsx)(l,{className:"h-4 w-4"})})]})]}),(0,n.jsx)("div",{className:"hidden lg:block",children:(0,n.jsx)("div",{className:"grid gap-6",style:{gridTemplateColumns:"repeat(".concat(c,", 1fr)")},children:j.slice(u,u+c).map((e,t)=>(0,n.jsx)(m,{poster:e,index:u+t,section:r||"carousel"},e.id))})}),(0,n.jsx)("div",{className:"lg:hidden",children:(0,n.jsx)("div",{ref:k,className:"flex space-x-4 overflow-x-auto pb-4 scrollbar-hide",onMouseDown:e=>{var t,r;h(!0),y(e.pageX-((null===(t=k.current)||void 0===t?void 0:t.offsetLeft)||0)),b((null===(r=k.current)||void 0===r?void 0:r.scrollLeft)||0)},onMouseMove:e=>{if(!f||!k.current)return;e.preventDefault();let t=e.pageX-(k.current.offsetLeft||0);k.current.scrollLeft=x-(t-p)*2},onMouseUp:()=>{h(!1)},onMouseLeave:()=>{h(!1)},onTouchStart:e=>{var t,r;h(!0),y(e.touches[0].pageX-((null===(t=k.current)||void 0===t?void 0:t.offsetLeft)||0)),b((null===(r=k.current)||void 0===r?void 0:r.scrollLeft)||0)},onTouchMove:e=>{if(!f||!k.current)return;let t=e.touches[0].pageX-(k.current.offsetLeft||0);k.current.scrollLeft=x-(t-p)*2},onTouchEnd:()=>{h(!1)},style:{cursor:f?"grabbing":"grab"},children:j.map((e,t)=>(0,n.jsx)("div",{className:"flex-none w-48",children:(0,n.jsx)(m,{poster:e,index:t,section:r||"carousel"})},e.id))})}),a&&j.length>c&&(0,n.jsx)("div",{className:"flex justify-center space-x-2",children:Array.from({length:w+1}).map((e,t)=>(0,n.jsx)("button",{onClick:()=>I(t),className:(0,v.cn)("w-2 h-2 rounded-full transition-colors",t===u?"bg-primary":"bg-muted"),"aria-label":"Go to slide ".concat(t+1)},t))})]})}var y=r(9116);function x(){let[e,t]=(0,s.useState)([]),[r,i]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{(async()=>{try{i(!0);let e=await (0,y.a)("/titles/top");if(e.ok&&e.data){let r=e.data.map(e=>({id:e.id,title:e.name,poster:e.poster_url||"/placeholder-poster.jpg",slug:e.slug,year:e.year,rating:e.rating}));t(r)}}catch(e){console.error("获取数据失败:",e)}finally{i(!1)}})()},[]),r)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,n.jsx)("div",{className:"text-white text-xl",children:"加载中..."})}):(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:[(0,n.jsx)("h1",{className:"text-4xl font-bold mb-8",children:"热门排行榜"}),(0,n.jsx)("section",{className:"mb-12",children:(0,n.jsx)(p,{items:e,title:"Most Popular",itemsPerView:4})})]})}},5974:function(e,t,r){"use strict";r.d(t,{C:function(){return o}});var n=r(7437);r(2265);var s=r(535),i=r(4508);let a=(0,s.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...s}=e;return(0,n.jsx)("div",{className:(0,i.cn)(a({variant:r}),t),...s})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(7437),s=r(2265),i=r(5293),a=r(535),o=r(4508);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:a,asChild:c=!1,...u}=e,d=c?i.g7:"button";return(0,n.jsx)(d,{className:(0,o.cn)(l({variant:s,size:a,className:r})),ref:t,...u})});c.displayName="Button"},3548:function(e,t,r){"use strict";r.d(t,{IH:function(){return o},co:function(){return l},uF:function(){return a}});var n=r(4147);class s{initAnalytics(e){try{this.initSession(),this.loadUser(),this.apiBase=e.endpoint||"/api/v1/analytics",document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),window.addEventListener("beforeunload",this.handleBeforeUnload.bind(this)),console.log("Analytics initialized successfully")}catch(e){console.error("Analytics initialization failed:",e)}}initSession(){let e=localStorage.getItem("dramini_analytics_visitor_id");e||(e=(0,n.Z)(),localStorage.setItem("dramini_analytics_visitor_id",e)),this.visitorId=e;let t="dramini_analytics_",r=localStorage.getItem(t+"session_last_ts"),s=Date.now();!r||s-parseInt(r)>18e5?(this.sessionId=(0,n.Z)(),localStorage.setItem(t+"session_id",this.sessionId)):this.sessionId=localStorage.getItem(t+"session_id")||(0,n.Z)(),localStorage.setItem(t+"session_last_ts",s.toString())}loadUser(){this.userId=localStorage.getItem("dramini_user_id")||null}sendEvent(e){this.eventQueue.push(e),this.eventQueue.length>=5&&this.flushEvents()}flushEvents(){if(0===this.eventQueue.length)return;let e=[...this.eventQueue];this.eventQueue=[];let t=JSON.stringify({events:e});fetch(this.apiBase+"/track",{method:"POST",headers:{"Content-Type":"application/json","x-analytics-key":"dramini2025"},body:t,keepalive:!0}).catch(e=>{console.warn("Analytics flush failed:",e)})}trackEvent(e,t){let r={event_id:(0,n.Z)(),event_name:e,visitor_id:this.visitorId,session_id:this.sessionId,user_id:this.userId||void 0,props:t||{},created_at:new Date().toISOString()};this.sendEvent(r)}trackLogin(e,t){this.trackEvent("login",{user_id:e,method:t||"email"})}trackRegistration(e,t){this.trackEvent("registration",{user_id:e,method:t||"email"})}trackVideoPlay(e,t,r){this.trackEvent("video_play",{content_id:e,content_type:t,duration:r||0})}trackPurchase(e,t,r,n){this.trackEvent("purchase",{order_id:e,amount:t,currency:r,method:n||"unknown"})}trackSearch(e,t){this.trackEvent("search",{query:e,results_count:t||0})}trackShare(e,t,r){this.trackEvent("share",{content_id:e,content_type:t,platform:r||"unknown"})}setUserId(e){this.userId=e,localStorage.setItem("dramini_user_id",e)}handleVisibilityChange(){this.flushEvents()}handleBeforeUnload(){this.flushEvents()}getVisitorId(){return this.visitorId}getSessionId(){return this.sessionId}constructor(){this.visitorId=null,this.sessionId=null,this.userId=null,this.apiBase="",this.eventQueue=[]}}let i=null;function a(e){(i=new s).initAnalytics(e)}function o(){return i}let l={initAnalytics:e=>{a(e)},trackEvent:(e,t)=>{let r=i;r&&r.trackEvent(e,t)},trackLogin:(e,t)=>{let r=i;r&&r.trackLogin(e,t)},trackRegistration:(e,t)=>{let r=i;r&&r.trackRegistration(e,t)},trackVideoPlay:(e,t,r)=>{let n=i;n&&n.trackVideoPlay(e,t,r)},trackPurchase:(e,t,r,n)=>{let s=i;s&&s.trackPurchase(e,t,r,n)},trackSearch:(e,t)=>{let r=i;r&&r.trackSearch(e,t)},trackShare:(e,t,r)=>{let n=i;n&&n.trackShare(e,t,r)},getVisitorId:()=>{let e=i;return e?e.getVisitorId():null},getSessionId:()=>{let e=i;return e?e.getSessionId():null},setUserId:e=>{let t=i;t&&t.setUserId(e)}}},9116:function(e,t,r){"use strict";async function n(e){try{let t=await fetch("".concat("https://dramini-api.onrender.com/api/v1").concat(e));if(!t.ok)return{ok:!1,data:null,error:"HTTP ".concat(t.status)};let r=await t.json();return{ok:!0,data:r}}catch(e){return{ok:!1,data:null,error:e instanceof Error?e.message:"Unknown error"}}}r.d(t,{a:function(){return n}})},4508:function(e,t,r){"use strict";r.d(t,{T4:function(){return a},cn:function(){return i}});var n=r(1994),s=r(3335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,n.W)(t))}function a(e){return"$".concat((e/100).toFixed(2))}},6337:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},3276:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]])},6595:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(9763).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},3145:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(8461),s=r.n(n)},8461:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return l},getImageProps:function(){return o}});let n=r(7043),s=r(5346),i=r(5878),a=n._(r(5084));function o(e){let{props:t}=(0,s.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let l=i.Image},5523:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return n}});let n=r(7043)._(r(2265)).default.createContext(null)},4147:function(e,t,r){"use strict";let n;r.d(t,{Z:function(){return o}});var s={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let i=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));var o=function(e,t,r){return!s.randomUUID||t||e?function(e,t,r){let s=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(i)}();if(s.length<16)throw Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=s[e];return t}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(s)}(e,t,r):s.randomUUID()}}},function(e){e.O(0,[413,878,971,117,744],function(){return e(e.s=1894)}),_N_E=e.O()}]);