"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[742],{4279:function(e,t,n){n.d(t,{h:function(){return g}});var r=n(7437),i=n(2265),s=n(7648),a=n(9376),o=n(2869),l=n(9232),c=n(2369),d=n(7692),u=n(2489);let h=(0,n(9763).Z)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);var m=n(4508),f=n(3548);function g(){var e,t;let[n,g]=(0,i.useState)(!1),[x,p]=(0,i.useState)(!1),[v,y]=(0,i.useState)(!1),[k,w]=(0,i.useState)(null),[b,j]=(0,i.useState)(!1),S=(0,a.usePathname)();(0,i.useEffect)(()=>{j(!0),I()},[]),(0,i.useEffect)(()=>{let e=()=>{I()};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]);let I=async()=>{{let e=localStorage.getItem("userId"),t=localStorage.getItem("userEmail"),n=localStorage.getItem("userName");if(console.log("\uD83D\uDD0D Header checkLoginStatus:",{userId:e,userEmail:t,userName:n}),e&&t&&n)try{console.log("\uD83D\uDD0D Fetching user profile for userId:",e);let r=await fetch("/api/user/profile?userId=".concat(encodeURIComponent(e)));if(console.log("\uD83D\uDD0D Profile API response status:",r.status),r.ok){let i=await r.json();console.log("\uD83D\uDD0D Profile API response data:",i),w({id:e,email:t,name:n,coins:i.coins||0}),console.log("✅ User state updated with coins:",i.coins)}else console.log("❌ Profile API failed:",r.status),w({id:e,email:t,name:n,coins:0})}catch(r){console.error("❌ Profile API error:",r),w({id:e,email:t,name:n,coins:0})}else w(null)}};(0,i.useEffect)(()=>{let e=()=>{g(window.scrollY>64)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);let N=[{name:"Home",href:"/"},{name:"Browse",href:"/browse"},{name:"Top Charts",href:"/top"},{name:"Categories",href:"/categories"}],E=e=>{f.co.trackEvent("page_navigation",{path:e}),p(!1)},_=()=>{w(null),localStorage.removeItem("userId"),localStorage.removeItem("userEmail"),localStorage.removeItem("userName"),y(!1),window.location.reload()};return b?(0,r.jsxs)("header",{className:(0,m.cn)("fixed top-0 left-0 right-0 z-50 transition-all duration-300",n?"py-2 bg-black/50 backdrop-blur-md border-b border-gray-800":"py-4 bg-transparent"),children:[(0,r.jsx)("div",{className:"max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,r.jsx)(s.default,{href:"/",className:"text-2xl font-bold text-red-500 hover:text-red-400 transition-colors",onClick:()=>f.co.trackEvent("page_navigation",{path:"/",title:"ShortDramini - 首页"}),children:"Dramini"}),(0,r.jsx)("nav",{className:"hidden md:flex items-center space-x-8",children:N.map(e=>(0,r.jsx)(s.default,{href:e.href,className:(0,m.cn)("text-sm font-medium transition-colors hover:text-white/80",S===e.href?"text-white":"text-white/60"),onClick:()=>E(e.name),children:e.name},e.name))})]}),(0,r.jsx)("div",{className:"hidden md:flex items-center space-x-4",children:k?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 text-yellow-400",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),(0,r.jsx)("span",{className:"text-sm font-semibold",children:k.coins||0})]}),(0,r.jsx)(o.z,{variant:"ghost",className:"flex items-center gap-2 p-1",onClick:()=>y(!v),children:(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg",children:(0,r.jsx)("span",{className:"text-white text-sm font-bold",children:(null===(e=k.name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"U"})})})]}),v&&(0,r.jsx)("div",{className:"absolute right-0 top-full mt-2 w-48 bg-gray-900 border border-gray-700 rounded-md shadow-lg z-50",children:(0,r.jsxs)("div",{className:"py-1",children:[(0,r.jsxs)("div",{className:"px-4 py-2 border-b border-gray-700",children:[(0,r.jsx)("div",{className:"text-white font-semibold",children:k.name}),(0,r.jsx)("div",{className:"text-gray-400 text-sm",children:k.email})]}),(0,r.jsxs)(s.default,{href:"/profile",className:"flex items-center px-4 py-2 text-white hover:bg-gray-800",onClick:()=>y(!1),children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 mr-2"}),"Profile"]}),(0,r.jsxs)(s.default,{href:"/profile",className:"flex items-center px-4 py-2 text-white hover:bg-gray-800",onClick:()=>y(!1),children:[(0,r.jsx)(l.Z,{className:"w-4 h-4 mr-2"}),"My Coins"]}),(0,r.jsx)("hr",{className:"border-gray-700 my-1"}),(0,r.jsxs)("button",{className:"flex items-center w-full px-4 py-2 text-red-400 hover:bg-gray-800",onClick:_,children:[(0,r.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"Sign Out"]})]})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.default,{href:"/login",children:(0,r.jsx)(o.z,{variant:"ghost",children:"Sign In"})}),(0,r.jsx)(s.default,{href:"/login",children:(0,r.jsx)(o.z,{className:"bg-red-600 hover:bg-red-700",children:"Sign Up"})})]})}),(0,r.jsx)(o.z,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>p(!x),children:x?(0,r.jsx)(u.Z,{className:"h-6 w-6"}):(0,r.jsx)(h,{className:"h-6 w-6"})})]})}),x&&(0,r.jsx)("div",{className:"md:hidden bg-black/95 backdrop-blur-md border-t border-gray-800",children:(0,r.jsxs)("div",{className:"px-4 py-4 space-y-4",children:[N.map(e=>(0,r.jsx)(s.default,{href:e.href,className:"block text-white hover:text-red-400 transition-colors py-2",onClick:()=>p(!1),children:e.name},e.name)),(0,r.jsx)("hr",{className:"border-gray-700"}),k?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg",children:(0,r.jsx)("span",{className:"text-white text-sm font-bold",children:(null===(t=k.name)||void 0===t?void 0:t.charAt(0).toUpperCase())||"U"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-white font-semibold",children:k.name}),(0,r.jsx)("div",{className:"text-gray-400 text-sm",children:k.email})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-yellow-400",children:[(0,r.jsx)(l.Z,{className:"w-4 h-4"}),(0,r.jsxs)("span",{className:"text-sm",children:[k.coins||0," coins"]})]}),(0,r.jsx)(s.default,{href:"/profile",className:"block text-white hover:text-red-400 transition-colors py-2",onClick:()=>p(!1),children:"Profile"}),(0,r.jsx)("button",{className:"block text-red-400 hover:text-red-300 transition-colors py-2",onClick:_,children:"Sign Out"})]}):(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(s.default,{href:"/login",className:"block text-white hover:text-red-400 transition-colors py-2",onClick:()=>p(!1),children:"Sign In"}),(0,r.jsx)(s.default,{href:"/login",className:"block text-white hover:text-red-400 transition-colors py-2",onClick:()=>p(!1),children:"Sign Up"})]})]})})]}):(0,r.jsx)("header",{className:"fixed top-0 left-0 right-0 z-50 py-4 bg-transparent",children:(0,r.jsx)("div",{className:"max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,r.jsx)(s.default,{href:"/",className:"text-2xl font-bold text-red-500",children:"Dramini"}),(0,r.jsxs)("div",{className:"hidden md:flex items-center space-x-4",children:[(0,r.jsx)(s.default,{href:"/login",children:(0,r.jsx)(o.z,{variant:"ghost",children:"Sign In"})}),(0,r.jsx)(s.default,{href:"/login",children:(0,r.jsx)(o.z,{className:"bg-red-600 hover:bg-red-700",children:"Sign Up"})})]})]})})})}},2869:function(e,t,n){n.d(t,{z:function(){return c}});var r=n(7437),i=n(2265),s=n(5293),a=n(535),o=n(4508);let l=(0,a.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=i.forwardRef((e,t)=>{let{className:n,variant:i,size:a,asChild:c=!1,...d}=e,u=c?s.g7:"button";return(0,r.jsx)(u,{className:(0,o.cn)(l({variant:i,size:a,className:n})),ref:t,...d})});c.displayName="Button"},9490:function(e,t,n){n.d(t,{z:function(){return o},j:function(){return a}});var r=n(3548),i=n(2265),s=n(9376);function a(e){!function(){let e=(0,s.usePathname)(),t=(0,i.useRef)(),n=(0,i.useRef)(!0);(0,i.useEffect)(()=>{let i=(0,r.IH)();if(!i){console.warn("Analytics not initialized in useSPATracking");return}let s=()=>{let r=t.current;if(r!==e||n.current){let s=document.title||"",a=r||document.referrer;console.log("SPA Route change:",{from:r,to:e,title:s}),i.trackEvent("page_view",{currentPath:e,page:e,title:s,referrer:a}),t.current=e,n.current=!1}};s();let a=()=>{console.log("popstate detected, pathname will update via router")},o=window.history.pushState,l=window.history.replaceState;return window.history.pushState=function(t,n,r){o.call(this,t,n,r),new URL(r||"",window.location.origin).pathname!==e&&setTimeout(()=>{s()},0)},window.history.replaceState=function(e,t,n){l.call(this,e,t,n),console.log("replaceState detected:",new URL(n||"",window.location.origin).pathname)},window.addEventListener("popstate",a),()=>{window.removeEventListener("popstate",a),window.history.pushState=o,window.history.replaceState=l}},[e])}(),(0,i.useEffect)(()=>{e&&"undefined"!=typeof document&&(document.title=e)},[e])}function o(){let e=(0,r.IH)();return e?{trackEvent:e.trackEvent.bind(e),trackLogin:e.trackLogin.bind(e),trackRegistration:e.trackRegistration.bind(e),trackVideoPlay:e.trackVideoPlay.bind(e),trackPurchase:e.trackPurchase.bind(e),trackSearch:e.trackSearch.bind(e),trackShare:e.trackShare.bind(e),setUserId:e.setUserId.bind(e)}:(console.warn("Analytics not initialized"),{trackEvent:()=>console.warn("Analytics not initialized"),trackLogin:()=>console.warn("Analytics not initialized"),trackRegistration:()=>console.warn("Analytics not initialized"),trackVideoPlay:()=>console.warn("Analytics not initialized"),trackPurchase:()=>console.warn("Analytics not initialized"),trackSearch:()=>console.warn("Analytics not initialized"),trackShare:()=>console.warn("Analytics not initialized"),setUserId:()=>console.warn("Analytics not initialized")})}},3548:function(e,t,n){n.d(t,{IH:function(){return o},co:function(){return l},uF:function(){return a}});var r=n(4147);class i{initAnalytics(e){try{this.initSession(),this.loadUser(),this.apiBase=e.endpoint||"/api/v1/analytics",document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),window.addEventListener("beforeunload",this.handleBeforeUnload.bind(this)),console.log("Analytics initialized successfully")}catch(e){console.error("Analytics initialization failed:",e)}}initSession(){let e=localStorage.getItem("dramini_analytics_visitor_id");e||(e=(0,r.Z)(),localStorage.setItem("dramini_analytics_visitor_id",e)),this.visitorId=e;let t="dramini_analytics_",n=localStorage.getItem(t+"session_last_ts"),i=Date.now();!n||i-parseInt(n)>18e5?(this.sessionId=(0,r.Z)(),localStorage.setItem(t+"session_id",this.sessionId)):this.sessionId=localStorage.getItem(t+"session_id")||(0,r.Z)(),localStorage.setItem(t+"session_last_ts",i.toString())}loadUser(){this.userId=localStorage.getItem("dramini_user_id")||null}sendEvent(e){this.eventQueue.push(e),this.eventQueue.length>=5&&this.flushEvents()}flushEvents(){if(0===this.eventQueue.length)return;let e=[...this.eventQueue];this.eventQueue=[];let t=JSON.stringify({events:e});fetch(this.apiBase+"/track",{method:"POST",headers:{"Content-Type":"application/json","x-analytics-key":"dramini2025"},body:t,keepalive:!0}).catch(e=>{console.warn("Analytics flush failed:",e)})}trackEvent(e,t){let n={event_id:(0,r.Z)(),event_name:e,visitor_id:this.visitorId,session_id:this.sessionId,user_id:this.userId||void 0,props:t||{},created_at:new Date().toISOString()};this.sendEvent(n)}trackLogin(e,t){this.trackEvent("login",{user_id:e,method:t||"email"})}trackRegistration(e,t){this.trackEvent("registration",{user_id:e,method:t||"email"})}trackVideoPlay(e,t,n){this.trackEvent("video_play",{content_id:e,content_type:t,duration:n||0})}trackPurchase(e,t,n,r){this.trackEvent("purchase",{order_id:e,amount:t,currency:n,method:r||"unknown"})}trackSearch(e,t){this.trackEvent("search",{query:e,results_count:t||0})}trackShare(e,t,n){this.trackEvent("share",{content_id:e,content_type:t,platform:n||"unknown"})}setUserId(e){this.userId=e,localStorage.setItem("dramini_user_id",e)}handleVisibilityChange(){this.flushEvents()}handleBeforeUnload(){this.flushEvents()}getVisitorId(){return this.visitorId}getSessionId(){return this.sessionId}constructor(){this.visitorId=null,this.sessionId=null,this.userId=null,this.apiBase="",this.eventQueue=[]}}let s=null;function a(e){(s=new i).initAnalytics(e)}function o(){return s}let l={initAnalytics:e=>{a(e)},trackEvent:(e,t)=>{let n=s;n&&n.trackEvent(e,t)},trackLogin:(e,t)=>{let n=s;n&&n.trackLogin(e,t)},trackRegistration:(e,t)=>{let n=s;n&&n.trackRegistration(e,t)},trackVideoPlay:(e,t,n)=>{let r=s;r&&r.trackVideoPlay(e,t,n)},trackPurchase:(e,t,n,r)=>{let i=s;i&&i.trackPurchase(e,t,n,r)},trackSearch:(e,t)=>{let n=s;n&&n.trackSearch(e,t)},trackShare:(e,t,n)=>{let r=s;r&&r.trackShare(e,t,n)},getVisitorId:()=>{let e=s;return e?e.getVisitorId():null},getSessionId:()=>{let e=s;return e?e.getSessionId():null},setUserId:e=>{let t=s;t&&t.setUserId(e)}}},4508:function(e,t,n){n.d(t,{T4:function(){return a},cn:function(){return s}});var r=n(1994),i=n(3335);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,i.m6)((0,r.W)(t))}function a(e){return"$".concat((e/100).toFixed(2))}},9232:function(e,t,n){n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]])},7692:function(e,t,n){n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},2369:function(e,t,n){n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2489:function(e,t,n){n.d(t,{Z:function(){return r}});let r=(0,n(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,t,n){n.d(t,{default:function(){return i.a}});var r=n(2972),i=n.n(r)},9376:function(e,t,n){var r=n(5475);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}}),n.o(r,"useSearchParams")&&n.d(t,{useSearchParams:function(){return r.useSearchParams}})},4147:function(e,t,n){let r;n.d(t,{Z:function(){return o}});var i={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let s=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));var o=function(e,t,n){return!i.randomUUID||t||e?function(e,t,n){let i=(e=e||{}).random??e.rng?.()??function(){if(!r){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");r=crypto.getRandomValues.bind(crypto)}return r(s)}();if(i.length<16)throw Error("Random bytes length must be >= 16");if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){if((n=n||0)<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=i[e];return t}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(i)}(e,t,n):i.randomUUID()}}}]);